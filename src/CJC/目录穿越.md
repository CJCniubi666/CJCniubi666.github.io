---
title: 目录穿越
date: 2023-08-05 13:53:14
tags:
- web漏洞
categories:
- web漏洞
---





## 原理

**目录穿越**（Directory Traversal）是一种常见的安全漏洞，它存在于**许多网络应用程序**中。这种漏洞允许攻击者访问系统中**未经授权的文件或目录**，甚至可能**允许攻击者执行恶意代码**。

该漏洞通常发生在服务器端，当应用程序未能正确验证用户提供的文件路径或目录名时，攻击者可以在路径中使用特殊字符或序列来跳出当前目录，访问系统中的其他目录或文件。攻击者利用这个漏洞可以获取敏感信息、篡改或删除文件，甚至在某些情况下执行远程代码。

例如，在Web应用程序中，当用户在URL中输入文件名或路径时，应用程序可能会在服务器端使用这些输入来访问文件并返回给用户。如果应用程序没有对输入进行恰当的验证和过滤，攻击者可以通过在输入中添加"../"或其他特殊字符来绕过应用程序的目录限制，进而访问系统上的其他目录或文件。

以下是一个简单的示例，假设Web应用程序允许用户通过URL下载文件：

正常请求：http ://example.com/download?file=documents/report.pdf

攻击者可以通过以下方式进行目录穿越攻击：

恶意请求：http ://example.com/download?file=../../../../../etc/passwd

在上面的例子中，攻击者使用"../"来逐级返回目录，最终访问了系统的/etc/passwd文件，这是一个包含用户账户信息的敏感文件。

要防止目录穿越漏洞，开发者应该对所有输入进行严格的验证和过滤，并在访问文件系统资源之前，将输入路径转换为绝对路径。最好的方式是使用白名单验证，仅允许特定的目录或文件访问，而不是仅仅过滤"../"等字符。

总之，目录穿越漏洞是一种常见的安全问题，开发者和系统管理员应该意识到它的存在，并采取适当的措施来防止它的发生。

## 相对路径

`../../../etc/passwd`



## 绝对路径

`/etc/passwd`



## 双写../绕过

`....//....//....//etc/passwd`



## URL编码绕过

`../`

第一次：`%2e%2e%2f`

第二次：`%252e%252e%252f`



`..%252f..%252f..%252fetc/passwd`



##  绝对路径配合../绕过

`../../../etc/passwd`

## %00截断文件后缀绕过

`../../../etc/passwd%00.png`



## 防御

防范的方法
要防范目录穿越与远程文件调用攻击，可以使用下列方法：
(1）不要使用使用者提供的文件名
(2）检查使用者输入的文件名中是否有".."的目录级层的字符
(3)   php.ini 文件中设置 open_basedir 来指定可以打开文件的目录
(4)   php.ini 文件中设置 allow_url_fopen 为 Off ，来让 Web 应用程序不能打开远程文件
(5)   realpath 与 basename 函数来处理使用者输入的文件名
